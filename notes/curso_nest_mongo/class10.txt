쯈u칠 es Mongoose? Instalaci칩n y configuraci칩n

Utilizar el driver oficial de MongoDB para NestJS es una buena manera de trabajar y relacionar estos dos mundos. Pero existe una forma mucho m치s profesional y amigable que te ayudar치 a trabajar m치s r치pido y cometer menos errores.

쯈u칠 es Mongoose como ODM?
Mongoose es un ODM (Object Data Modeling) que permite realizar un mapeo de cada colecci칩n de tu base de datos MongoDB a trav칠s de esquemas. Estos te ayudar치n a acceder a los datos, realizar consultas complejas y estandarizar la estructura de los mismos.

En MongoDB, al ser NoSQL, puedes guardar lo que quieras, en el orden que quieras y con la estructura que quieras. Esto es una muy mala pr치ctica que tienes que evitar ya que traer치 serios problemas en un futuro no muy lejano en tu proyecto. Los ODM llegan para solucionar esto.

C칩mo instalar Mongoose
Te dejamos esta serie de pasos para utilizar Mongoose.

Paso 1: instalaci칩n de Mongoose
Adem치s de la instalaci칩n de Mongoose, NestJS posee su propia librer칤a que te ayudar치 a crear los esquemas, inyectar los servicios y ejecutar las consultas a tu base de datos.

npm install --save @nestjs/mongoose mongoose
Paso 2: importaci칩n y configuraci칩n de Mongoose
Importa el m칩dulo MongooseModule y p치sale la cadena de conexi칩n utilizando, o no, variables de entorno.

import { MongooseModule } from '@nestjs/mongoose';
@Module({
  imports: [
    MongooseModule.forRoot( `${process.env.MONGO_CONF}://${process.env.MONGO_USER}:${process.env.MONGO_PASS}@${process.env.MONGO_HOST}/${process.env.MONGO_BBDD}`
    )
  ]
})
export class AppModule { }
De esta manera, habr치s realizado la conexi칩n de tu base de datos a trav칠s de Mongoose, en lugar de utilizar el driver oficial.

Contribuci칩n creada por: Kevin Fiorentino.

C칩digo de ejemplo para instalaci칩n de Mongoose
npm install --save @nestjs/mongoose mongoose
// src/database/database.module.ts
import { MongooseModule } from '@nestjs/mongoose'; // 游녣 Import

@Global()
@Module({
  imports: [  // 游녣
    MongooseModule.forRootAsync({ // 游녣 Implement Module
      useFactory: (configService: ConfigType<typeof config>) => {
        const {
          connection,
          user,
          password,
          host,
          port,
          dbName,
        } = configService.mongo;
        return {
          uri: `${connection}://${host}:${port}`,
          user,
          pass: password,
          dbName,
        };
      },
      inject: [config.KEY],
    }),
  ],
  providers: [
    {
      provide: 'API_KEY',
      inject: [config.KEY],
    },
  ],
  exports: ['API_KEY', 'MONGO', MongooseModule],  // 游녣 add in exports
})
export class DatabaseModule {}
